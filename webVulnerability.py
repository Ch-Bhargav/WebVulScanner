# Importing necessary libraries for web scanning
import requests
from bs4 import BeautifulSoup
from urllib.parse import urljoin

# Define a class to encapsulate the web vulnerability scanner
class WebVulnerabilityScanner:
    def __init__(self, url):
        # Initialize the URL and the session
        self.session = requests.Session()
        self.url = url
        self.forms = []

    def extract_forms(self):
        # Get the webpage content
        response = self.session.get(self.url)
        # Parse the webpage using BeautifulSoup
        soup = BeautifulSoup(response.text, 'html.parser')
        # Find all forms in the webpage
        self.forms = soup.find_all('form')
    
    def check_vulnerabilities(self):
        # Check vulnerabilities by attempting to inject code
        for form in self.forms:
            action = form.get('action')
            if action:
                post_url = urljoin(self.url, action)
            else:
                # Handle case where action attribute is missing
                continue
            
            method = form.get('method')
            
            # Create a dictionary for form inputs
            inputs = {}
            for input_tag in form.find_all('input'):
                name = input_tag.get('name')
                input_type = input_tag.get('type', 'text')
                inputs[name] = 'test' if input_type != 'submit' else None

            # Attempt an XSS attack
            inputs = {key: '<script>alert(1)</script>' if value == 'test' else None for key, value in inputs.items()}
            if method and method.lower() == 'post':
                response = self.session.post(post_url, data=inputs)
            else:
                response = self.session.get(post_url, params=inputs)
            
            # Check if the payload executed
            if '<script>alert(1)</script>' in response.text:
                print(f'Form at {post_url} is vulnerable to XSS.')

# Instantiate the scanner and run the scan
if __name__ == '__main__':
    url = 'http://testphp.vulnweb.com' # Replace with the URL you want to scan
    scanner = WebVulnerabilityScanner(url)
    scanner.extract_forms()
    scanner.check_vulnerabilities()

